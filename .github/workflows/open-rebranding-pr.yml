name: Open/Update Rebranding PR

on:
  push:
    branches:
      - feat/rebranding-gexu
  workflow_dispatch: {}

permissions:
  contents: write
  pull-requests: write

jobs:
  open-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Create or update PR feat/rebranding-gexu -> main
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const head = 'feat/rebranding-gexu';
            const base = 'main';
            const title = 'Rebranding mínimo + CI + Upstream sweep';
            const body = [
              'Este PR aplica el rebranding mínimo (applicationId, app_name, ícono adaptive), fija CI para :app:assembleStandardDebug y añade el barrido a upstream.',
              '',
              '- applicationId = com.ramsesbr.gexu',
              '- app_name = Gexu',
              '- workflows: android.yml y upstream-sweep.yml',
              '',
              'Al mergear, el CI adjunta el APK en artefactos.'
            ].join('\n');

            // List open PRs matching head/base
            const { data: prs } = await github.rest.pulls.list({ owner, repo, state: 'open', head: `${owner}:${head}`, base });
            if (prs.length > 0) {
              const pr = prs[0];
              await github.rest.pulls.update({ owner, repo, pull_number: pr.number, title, body });
              await github.rest.issues.addLabels({ owner, repo, issue_number: pr.number, labels: ['rebranding','CI','ready-to-merge'] });
              core.setOutput('pr_number', pr.number);
              core.info(`Updated PR #${pr.number}`);
            } else {
              const { data: pr } = await github.rest.pulls.create({ owner, repo, head, base, title, body });
              await github.rest.issues.addLabels({ owner, repo, issue_number: pr.number, labels: ['rebranding','CI','ready-to-merge'] });
              core.setOutput('pr_number', pr.number);
              core.info(`Created PR #${pr.number}`);
            }

